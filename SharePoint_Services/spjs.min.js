/* SP.JS WRAPPER 1.2.4 */
/* https://github.com/usaalex/SharePoint */
/* © WM-FDH, 2016 */
var SPJS = function (e) { "use strict"; function t(e) { this.name = "ArgumentNullException", this.message = "Value can not be null or undefined. Parameter name: " + e, this.stack = (new Error).stack } function n(e, t) { this.name = "ArgumentException", this.message = (t || "Argument exception") + ". Parameter name: " + e, this.stack = (new Error).stack } function r(e) { return "undefined" == typeof e || null === e || "" === e } function o(e) { return "undefined" != typeof e && e instanceof Array ? !e.length : !0 } function i(n, o, i, l) { if (r(n)) throw new t("list"); var s = e.Deferred(), a = SP.ClientContext.get_current(), u = l ? a.get_site().get_rootWeb() : a.get_web(), c = "string" == typeof n ? u.get_lists().getByTitle(n) : n, f = new SP.CamlQuery; f.set_viewXml(o || ""); var g = c.getItems(f); return i ? a.load(g, "Include(ID," + i.join(",") + ")") : a.load(g), a.executeQueryAsync(function (e, t) { s.resolve(g.get_data(), e, t) }, function (e, t) { s.reject(t, e) }), s.promise() } function l(i, l, s) { if (r(i)) throw new t("list"); if (r(l) || o(l)) throw new n("ids", "Value must be an array and have at least one element."); for (var a = e.Deferred(), u = SP.ClientContext.get_current(), c = s ? u.get_site().get_rootWeb() : u.get_web(), f = "string" == typeof i ? c.get_lists().getByTitle(i) : i, g = [], d = 0; d < l.length; d++) { var m = f.getItemById(l[d]); u.load(m), g.push(m) } return u.executeQueryAsync(function (e, t) { a.resolve(g, e, t) }, function (e, t) { a.reject(t, e) }), a.promise() } function s(i, l, s) { if (r(i)) throw new t("list"); if (r(l) || o(l)) throw new n("newItems", "Value must be an array and have at least one element."); for (var a = e.Deferred(), u = SP.ClientContext.get_current(), c = s ? u.get_site().get_rootWeb() : u.get_web(), f = "string" == typeof i ? c.get_lists().getByTitle(i) : i, g = [], d = 0; d < l.length; d++) if (l[d]) { var m = new SP.ListItemCreationInformation, w = f.addItem(m); for (var v in l[d]) if ("ID" != v) { var y = l[d][v] || null; w.set_item(v, y) } w.update(), g.push(w), u.load(w) } return u.executeQueryAsync(function (e, t) { a.resolve(g, e, t) }, function (e, t) { a.reject(t, e) }), a.promise() } function a(i, l, s) { if (r(i)) throw new t("list"); if (r(l) || o(l)) throw new n("updatedItems", "Value must be an array and have at least one element."); for (var a = e.Deferred(), u = SP.ClientContext.get_current(), c = s ? u.get_site().get_rootWeb() : u.get_web(), f = "string" == typeof i ? c.get_lists().getByTitle(i) : i, g = [], d = 0; d < l.length; d++) if (l[d] && l[d].ID && !(l[d].ID <= 0)) { var m = f.getItemById(l[d].ID); u.load(m, "ID") } return u.executeQueryAsync(function () { for (var e = 0; e < l.length; e++) if (l[e] && l[e].ID && !(l[e].ID <= 0)) { var t = f.getItemById(l[e].ID); for (var n in l[e]) if ("ID" != n) { var r = l[e][n] || null; t.set_item(n, r) } t.update(), g.push(t), u.load(t) } u.executeQueryAsync(function (e, t) { a.resolve(g, e, t) }, function (e, t) { a.reject(t, e) }) }, function (e, t) { a.reject(t) }), a.promise() } function u(e, n, o, l) { if (r(e)) throw new t("list"); if (r(n)) throw new t("camlQuery"); return i(e, n, ["ID"], l).then(function (t) { for (var n = [], r = 0; r < t.length; r++) n.push(t[r].get_item("ID")); return c(e, n, o, l) }) } function c(i, l, s, a) { if (r(i)) throw new t("list"); if (r(l) || o(l)) throw new n("ids", "Value must be an array and have at least one element."); for (var u = e.Deferred(), c = SP.ClientContext.get_current(), f = a ? c.get_site().get_rootWeb() : c.get_web(), g = "string" == typeof i ? f.get_lists().getByTitle(i) : i, d = 0; d < l.length; d++) { var m = g.getItemById(l[d]); s ? m.deleteObject() : m.recycle() } return c.executeQueryAsync(function (e, t) { u.resolve(!0, e, t) }, function (e, t) { u.reject(t, e) }), u.promise() } function f(e, t) { return g(e, t).then(function (e) { return e && e.get_id ? e.get_id().toString() || "" : "" }) } function g(n, o) { if (r(n)) throw new t("list"); var i = e.Deferred(), l = SP.ClientContext.get_current(), s = o ? l.get_site().get_rootWeb() : l.get_web(), a = "string" == typeof n ? s.get_lists().getByTitle(n) : n; return l.load(a), l.executeQueryAsync(function (e, t) { i.resolve(a, e, t) }, function (e, t) { i.reject(t, e) }), i.promise() } function d(n) { if (r(n)) throw new t("url"); var o = e.Deferred(), i = SP.ClientContext.get_current(), l = i.get_web(), s = l.getFileByServerRelativeUrl(n); return i.load(s), i.executeQueryAsync(function (e, t) { o.resolve(s, e, t) }, function (e, t) { o.reject(t, e) }), o.promise() } function m(n, o) { if (r(n)) throw new t("url"); var i = e.Deferred(); return v(n).always(function () { w(n, o, 0, !1).then(function () { i.resolve.apply(this, arguments) }).fail(function () { i.reject.apply(this, arguments) }) }), i.promise() } function w(n, o, i, l) { if (r(n)) throw new t("url"); var s = e.Deferred(), a = SP.ClientContext.get_current(), u = a.get_web(), c = u.getFileByServerRelativeUrl(n); return c.checkIn(o || "", i || 0), l || c.publish(), a.load(c), a.executeQueryAsync(function (e, t) { s.resolve(c.get_uiVersionLabel() || "0", e, t) }, function (e, t) { s.reject(t, e) }), s.promise() } function v(n) { if (r(n)) throw new t("url"); var o = e.Deferred(), i = SP.ClientContext.get_current(), l = i.get_web(), s = l.getFileByServerRelativeUrl(n); return s.checkOut(), i.load(s), i.executeQueryAsync(function (e, t) { o.resolve(s.get_uiVersionLabel() || "0", e, t) }, function (e, t) { o.reject(t, e) }), o.promise() } function y(n) { if (r(n)) throw new t("userName"); var o = e.Deferred(), i = SP.ClientContext.get_current(), l = i.get_web(), s = l.ensureUser(n); return i.load(s), i.executeQueryAsync(function (e, t) { o.resolve(s, e, t) }, function (e, t) { o.reject(t, e) }), o.promise() } function h(e, t) { var n = SP.ClientContext.get_current(), r = n.get_web(), o = r.get_siteUserInfoList(); return e instanceof Array || (e = [e || _spUserId]), l(o, e, t) } function p(e) { var t = document.createElement("div"); return t.innerHTML = e, t } function _(t, n, r, o) { var i = e.Deferred(), l = { title: t, allowMaximize: !1, showClose: !o, autoSize: !0, dialogReturnValueCallback: function (e, t) { i.resolve(e == SP.UI.DialogResult.OK, t) } }; return r ? l.url = r : l.html = p("<div class='dialog-wrapper' style='padding: 5px;'>{0}</div>".format(n)), SP.UI.ModalDialog.showModalDialog(l), i.promise() } function I(e, t, n) { return _(t, null, e, n) } function P(e, t) { var n = "<div class='message message-alert'>{0}</div>".format(e); return _(t || "Information", n) } function b(e, t) { var n = "<div class='message message-error' style='color: red;'>{0}</div>".format(e); return _(t || "Error", n) } function D(e, t) { var n = "<div class='message message-error'>{0}</div>                    <div class='controls' style='margin-top: 15px; text-align: right;'>                        <button onclick='SP.UI.ModalDialog.commonModalDialogClose(SP.UI.DialogResult.OK); return false;'>OK</button>                        <button onclick='SP.UI.ModalDialog.commonModalDialogClose(SP.UI.DialogResult.cancel); return false;'>Cancel</button>                    </div>".format(e); return _(t || "Confirm", n) } function C() { null != Q && (Q.close(), Q = null), null != R && (clearTimeout(R), R = null) } function S(e, t, n, r, o) { C(), Q = SP.UI.ModalDialog.showWaitScreenWithNoClose(t || "Processing", e || "Please wait...", r || 60, o || 300), +n > 0 && (R = setTimeout(C, +n)) } function x(e, t, n, r) { function o() { return new Array } function i(e, t, n) { e.push(t), e[t] = n } function l(e) { for (var t = new Array, n = 0; n < e.length; n++) t.push(e[n]); return t } null != document.getElementById("__spPickerHasReturnValue") && (document.getElementById("__spPickerHasReturnValue").value = ""), null != document.getElementById("__spPickerReturnValueHolder") && (document.getElementById("__spPickerReturnValueHolder").value = ""), commonModalDialogReturnValue.clear(); var s; if (window.showModalDialog && !browseris.safari125up) s = window.showModalDialog(e, r, t), n && invokeModalDialogCallback(n, s); else { var a = 500, u = 550, c = "yes"; if (t) { var f, g, d = o(); -1 != t.search(/^(\s*\w+\s*:\s*.+?\s*)(;\s*\s*\w+\s*:\s*.+?\s*)*(;\s*)?$/) ? (f = /^\s*(\w+)\s*:\s*(.+?)\s*$/, g = t.split(/\s*;\s*/)) : (f = /^\s*(\w+)\s*=\s*(.+?)\s*$/, g = t.split(/\s*,\s*/)); for (var m in g) { var w = f.exec(g[m]); w && 3 == w.length && i(d, w[1].toLowerCase(), w[2]) } d.width || i(d, "width", d.dialogwidth || a), d.height || i(d, "height", d.dialogheight || u), d.scrollbars || i(d, "scrollbars", d.scroll || c), t = ""; var v = l(d); for (var y in v) t && (t += ","), t += v[y] + "=" + d[v[y]] } else t = "width=" + a + ",height=" + u; var h = window.open(e, "_blank", t + ",modal=yes,dialog=yes"); h && (h.dialogArguments = r); var p = "/Picker.aspx".toUpperCase(), _ = e.toUpperCase().indexOf(p) > -1; _ || (window.onfocus = function () { var e = null != document.getElementById("__spPickerHasReturnValue") && "1" == document.getElementById("__spPickerHasReturnValue").value || commonModalDialogReturnValue.isSet(); !h || h.closed || e ? (window.onfocus = null, n && invokeModalDialogCallback(n, s)) : h.focus() }), browseris.ie || (window.fndlgClose = n) } return s } function k() { "function" == typeof commonShowModalDialog && (window.commonShowModalDialog = x) } function A(t) { var n = []; return e.each(e("div[id*='" + t + "'], " + t).find("> span.ms-entity-resolved"), function (t, r) { var o = e(r).attr("title") || null; n.push(o) }), n } function j(n, o) { if (r(n)) throw new t("key"); var i = e.Deferred(), l = SP.ClientContext.get_current(), s = o ? l.get_site().get_rootWeb() : l.get_web(), a = s.get_allProperties(); return l.load(a), l.executeQueryAsync(function (e, t) { var r = null; try { r = a.get_item(n) } catch (o) { } i.resolve(r, e, t) }, function (e, t) { i.reject(t, e) }), i.promise() } function B(n, o, i) { if (r(n)) throw new t("key"); null != o && "string" != typeof o && (o = JSON.stringify(o)), "undefined" == typeof o && (o = null); var l = e.Deferred(), s = SP.ClientContext.get_current(), a = i ? s.get_site().get_rootWeb() : s.get_web(), u = a.get_allProperties(); return u.set_item(n, o), a.update(), s.executeQueryAsync(function (e, t) { l.resolve(!0, e, t) }, function (e, t) { l.reject(t, e) }), l.promise() } function U(e) { return e ? "function" == typeof e.get_fieldValues ? e.get_fieldValues() || null : "function" == typeof e.get_objectData && "function" == typeof e.get_objectData().get_properties ? e.get_objectData().get_properties() || null : void 0 : null } function V(e) { if (r(e)) throw new t("spObjects"); for (var n = e instanceof Array ? e : [e], o = 0; o < n.length; o++) { var i = U(n[o]); i && (n[o] = i) } return e instanceof Array ? n : n[0] || null } var M = function () { return "1.2.2" }; String.prototype.format = function () { for (var e = this, t = 0; t < arguments.length; t++) { var n = new RegExp("{" + t + "\\}", "g"); e = e.replace(n, arguments[t]) } return e }; var Q = null, R = null; return { getListItems: i, getListItemsByIds: l, createListItems: s, deleteListItems: u, deleteListItemsByIds: c, updateListItems: a, ensureUser: y, getUserProfile: h, getGUID: f, getList: g, showSPAlert: P, showSPConfirm: D, showSPError: b, showSPPopup: I, showSPWaitDialog: S, hideSPWaitDialog: C, applyPeoplePickerFix: k, getEntitiesPeoplePicker: A, getPropertyBag: j, setPropertyBag: B, checkOutFile: v, checkInPublishFile: w, forcePublish: m, getFile: d, spObjectToObject: V, ver: M } }(jQuery);