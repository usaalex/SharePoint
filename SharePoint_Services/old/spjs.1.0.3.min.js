/* SP.JS WRAPPER 1.0.3 */
/* https://github.com/usaalex/SharePoint */
/* © WM-FDH, 2016 */
var SPJS = function (e) { "use strict"; function t(e) { this.name = "ArgumentNullException", this.message = "Value can not be null or undefined. Parameter name: " + e, this.stack = (new Error).stack } function n(e, t) { this.name = "ArgumentException", this.message = (t || "Argument exception") + ". Parameter name: " + e, this.stack = (new Error).stack } function r(e) { return "undefined" == typeof e || null === e || "" === e } function o(e) { return "undefined" != typeof e && e instanceof Array ? !e.length : !0 } function i(n, o, i, s) { if (r(n)) throw new t("list"); var a = e.Deferred(), l = SP.ClientContext.get_current(), u = s ? l.get_site().get_rootWeb() : l.get_web(), c = "string" == typeof n ? u.get_lists().getByTitle(n) : n, g = new SP.CamlQuery; g.set_viewXml(o || ""); var f = c.getItems(g); return i ? l.load(f, "Include(ID," + i.join(",") + ")") : l.load(f), l.executeQueryAsync(function (e, t) { a.resolve(f.$2_1, e, t) }, function (e, t) { a.reject(t, e) }), a.promise() } function s(i, s, a, l) { if (r(i)) throw new t("list"); if (r(s) || o(s)) throw new n("ids", "Value must be an array and have at least one element."); for (var u = e.Deferred(), c = SP.ClientContext.get_current(), g = l ? c.get_site().get_rootWeb() : c.get_web(), f = "string" == typeof i ? g.get_lists().getByTitle(i) : i, d = [], m = 0; m < s.length; m++) { var w = f.getItemById(s[m]); a ? c.load.apply(this, [w].concat(a)) : c.load(w), d.push(w) } return c.executeQueryAsync(function (e, t) { u.resolve(d, e, t) }, function (e, t) { u.reject(t, e) }), u.promise() } function a(i, s, a) { if (r(i)) throw new t("list"); if (r(s) || o(s)) throw new n("newItems", "Value must be an array and have at least one element."); for (var l = e.Deferred(), u = SP.ClientContext.get_current(), c = a ? u.get_site().get_rootWeb() : u.get_web(), g = "string" == typeof i ? c.get_lists().getByTitle(i) : i, f = [], d = 0; d < s.length; d++) if (s[d]) { var m = new SP.ListItemCreationInformation, w = g.addItem(m); for (var h in s[d]) if ("ID" != h) { var v = s[d][h] || null; w.set_item(h, v) } w.update(), f.push(w), u.load(w) } return u.executeQueryAsync(function (e, t) { l.resolve(f, e, t) }, function (e, t) { l.reject(t, e) }), l.promise() } function l(i, s, a) { if (r(i)) throw new t("list"); if (r(s) || o(s)) throw new n("updatedItems", "Value must be an array and have at least one element."); for (var l = e.Deferred(), u = SP.ClientContext.get_current(), c = a ? u.get_site().get_rootWeb() : u.get_web(), g = "string" == typeof i ? c.get_lists().getByTitle(i) : i, f = [], d = 0; d < s.length; d++) if (s[d] && s[d].ID && !(s[d].ID <= 0)) { var m = g.getItemById(s[d].ID); u.load(m, "ID") } return u.executeQueryAsync(function () { for (var e = 0; e < s.length; e++) if (s[e] && s[e].ID && !(s[e].ID <= 0)) { var t = g.getItemById(s[e].ID); for (var n in s[e]) if ("ID" != n) { var r = s[e][n] || null; t.set_item(n, r) } t.update(), f.push(t), u.load(t) } u.executeQueryAsync(function (e, t) { l.resolve(f, e, t) }, function (e, t) { l.reject(t, e) }) }, function (e, t) { l.reject(t) }), l.promise() } function u(e, n, o) { if (r(e)) throw new t("list"); if (r(n)) throw new t("camlQuery"); return i(e, n, ["ID"], o).then(function (t) { for (var n = [], r = 0; r < t.length; r++) n.push(t[r].get_item("ID")); return c(e, n, o) }) } function c(i, s, a) { if (r(i)) throw new t("list"); if (r(s) || o(s)) throw new n("ids", "Value must be an array and have at least one element."); for (var l = e.Deferred(), u = SP.ClientContext.get_current(), c = a ? u.get_site().get_rootWeb() : u.get_web(), g = "string" == typeof i ? c.get_lists().getByTitle(i) : i, f = 0; f < s.length; f++) { var d = g.getItemById(s[f]); d.deleteObject() } return u.executeQueryAsync(function (e, t) { l.resolve(!0, e, t) }, function (e, t) { l.reject(t, e) }), l.promise() } function g(n, o) { if (r(n)) throw new t("list"); var i = e.Deferred(), s = SP.ClientContext.get_current(), a = o ? s.get_site().get_rootWeb() : s.get_web(), l = "string" == typeof n ? a.get_lists().getByTitle(n) : n; return s.load(l), s.executeQueryAsync(function (e, t) { i.resolve(l.get_id().$5_0 || "", e, t) }, function (e, t) { i.reject(t, e) }), i.promise() } function f(n) { if (r(n)) throw new t("userName"); var o = e.Deferred(), i = SP.ClientContext.get_current(), s = i.get_web(), a = s.ensureUser(n); return i.load(a), i.executeQueryAsync(function (e, t) { o.resolve(a, e, t) }, function (e, t) { o.reject(t, e) }), o.promise() } function d(e, t) { var n = SP.ClientContext.get_current(), r = n.get_web(), o = r.get_siteUserInfoList(); return e instanceof Array || (e = [e || _spUserId]), s(o, e, t) } function m(e) { var t = document.createElement("div"); return t.innerHTML = e, t } function w(t, n, r, o) { var i = e.Deferred(), s = { title: t, allowMaximize: !1, showClose: !o, autoSize: !0, dialogReturnValueCallback: function (e, t) { i.resolve(e == SP.UI.DialogResult.OK, t) } }; return r ? s.url = r : s.html = m("<div class='dialog-wrapper' style='padding: 5px;'>{0}</div>".format(n)), SP.UI.ModalDialog.showModalDialog(s), i.promise() } function h(e, t, n) { return w(t, null, e, n) } function v(e, t) { var n = "<div class='message message-alert'>{0}</div>".format(e); return w(t || "Information", n) } function p(e, t) { var n = "<div class='message message-error' style='color: red;'>{0}</div>".format(e); return w(t || "Error", n) } function y(e, t) { var n = "<div class='message message-error'>{0}</div>                    <div class='controls' style='margin-top: 15px; text-align: right;'>                        <button onclick='SP.UI.ModalDialog.commonModalDialogClose(SP.UI.DialogResult.OK); return false;'>OK</button>                        <button onclick='SP.UI.ModalDialog.commonModalDialogClose(SP.UI.DialogResult.cancel); return false;'>Cancel</button>                    </div>".format(e); return w(t || "Confirm", n) } function _() { null != C && (C.close(), C = null), null != S && (clearTimeout(S), S = null) } function I(e, t, n, r, o) { _(), C = SP.UI.ModalDialog.showWaitScreenWithNoClose(t || "Processing", e || "Please wait...", r || 60, o || 300), +n > 0 && (S = setTimeout(_, +n)) } function D(e, t, n, r) { function o() { return new Array } function i(e, t, n) { e.push(t), e[t] = n } function s(e) { for (var t = new Array, n = 0; n < e.length; n++) t.push(e[n]); return t } null != document.getElementById("__spPickerHasReturnValue") && (document.getElementById("__spPickerHasReturnValue").value = ""), null != document.getElementById("__spPickerReturnValueHolder") && (document.getElementById("__spPickerReturnValueHolder").value = ""), commonModalDialogReturnValue.clear(); var a; if (window.showModalDialog && !browseris.safari125up) a = window.showModalDialog(e, r, t), n && invokeModalDialogCallback(n, a); else { var l = 500, u = 550, c = "yes"; if (t) { var g, f, d = o(); -1 != t.search(/^(\s*\w+\s*:\s*.+?\s*)(;\s*\s*\w+\s*:\s*.+?\s*)*(;\s*)?$/) ? (g = /^\s*(\w+)\s*:\s*(.+?)\s*$/, f = t.split(/\s*;\s*/)) : (g = /^\s*(\w+)\s*=\s*(.+?)\s*$/, f = t.split(/\s*,\s*/)); for (var m in f) { var w = g.exec(f[m]); w && 3 == w.length && i(d, w[1].toLowerCase(), w[2]) } d.width || i(d, "width", d.dialogwidth || l), d.height || i(d, "height", d.dialogheight || u), d.scrollbars || i(d, "scrollbars", d.scroll || c), t = ""; var h = s(d); for (var v in h) t && (t += ","), t += h[v] + "=" + d[h[v]] } else t = "width=" + l + ",height=" + u; var p = window.open(e, "_blank", t + ",modal=yes,dialog=yes"); p && (p.dialogArguments = r); var y = "/Picker.aspx".toUpperCase(), _ = e.toUpperCase().indexOf(y) > -1; _ || (window.onfocus = function () { var e = null != document.getElementById("__spPickerHasReturnValue") && "1" == document.getElementById("__spPickerHasReturnValue").value || commonModalDialogReturnValue.isSet(); !p || p.closed || e ? (window.onfocus = null, n && invokeModalDialogCallback(n, a)) : p.focus() }), browseris.ie || (window.fndlgClose = n) } return a } function P() { "function" == typeof commonShowModalDialog && (window.commonShowModalDialog = D) } function b(t) { var n = []; return e.each(e("div[id*='" + t + "'], " + t).find("> span.ms-entity-resolved"), function (t, r) { var o = e(r).attr("title") || null; n.push(o) }), n } String.prototype.format = function () { for (var e = this, t = 0; t < arguments.length; t++) e = e.replace("{" + t + "}", arguments[t]); return e }; var C = null, S = null; return { getListItems: i, getListItemsByIds: s, createListItems: a, deleteListItems: u, deleteListItemsByIds: c, updateListItems: l, ensureUser: f, getUserProfile: d, getGUID: g, showSPAlert: v, showSPConfirm: y, showSPError: p, showSPPopup: h, showSPWaitDialog: I, hideSPWaitDialog: _, applyPeoplePickerFix: P, getEntitiesPeoplePicker: b } }(jQuery);